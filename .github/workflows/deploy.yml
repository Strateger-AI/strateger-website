name: Deploy to Production

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest

    steps:
      - name: SSH into Production EC2 and Deploy
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.PROD_HOST }}
          username: ${{ secrets.PROD_USER }}
          key: ${{ secrets.PROD_SSH_KEY }}
          script: |
            cd ~/strateger-website
            echo "Pulling latest code from main..."
            git pull origin main

            echo "Building Next.js project..."
            pnpm run build

            echo "Generating dynamic sitemap and robots.txt..."
            pnpm run postBuild

            echo "Restarting production service..."
            sudo systemctl restart strateger-prod

            echo "Production deployment complete."
